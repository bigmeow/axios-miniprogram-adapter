!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e["axios-miniprogram-adapter"]=t()}(this,function(){"use strict";var t=Object.prototype.toString;function i(e){return"[object Array]"===t.call(e)}function r(e){return void 0===e}function n(e){return null!==e&&"object"==typeof e}function o(e){return"[object Function]"===t.call(e)}function a(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),i(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}var l={isArray:i,isArrayBuffer:function(e){return"[object ArrayBuffer]"===t.call(e)},isBuffer:function(e){return null!==e&&!r(e)&&null!==e.constructor&&!r(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:n,isUndefined:r,isDate:function(e){return"[object Date]"===t.call(e)},isFile:function(e){return"[object File]"===t.call(e)},isBlob:function(e){return"[object Blob]"===t.call(e)},isFunction:o,isStream:function(e){return n(e)&&o(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:a,merge:function r(){var n={};function e(e,t){"object"==typeof n[t]&&"object"==typeof e?n[t]=r(n[t],e):n[t]=e}for(var t=0,o=arguments.length;t<o;t++)a(arguments[t],e);return n},deepMerge:function r(){var n={};function e(e,t){"object"==typeof n[t]&&"object"==typeof e?n[t]=r(n[t],e):n[t]="object"==typeof e?r({},e):e}for(var t=0,o=arguments.length;t<o;t++)a(arguments[t],e);return n},extend:function(o,e,i){return a(e,function(e,t){var r,n;o[t]=i&&"function"==typeof e?(r=e,n=i,function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];return r.apply(n,e)}):e}),o},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}},b=function(e,t,r,n,o){var i,a,u,c,s,f=new Error(e);return a=t,u=r,c=n,s=o,(i=f).config=a,u&&(i.code=u),i.request=c,i.response=s,i.isAxiosError=!0,i.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},i};function y(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var v="wechat";var w=console.warn;return function(h){var f=function(){switch(!0){case"object"==typeof wx:return v="wechat",wx.request.bind(wx);case"object"==typeof swan:return v="baidu",swan.request.bind(swan);case"object"==typeof my:return v="alipay",(my.request||my.httpRequest).bind(my);default:return wx.request.bind(wx)}}();return new Promise(function(d,p){var t,e,r,n,o,i=h.data,a=h.headers,m={method:h.method&&h.method.toUpperCase()||"GET",url:function(e,t,r){if(!t)return e;var n;if(r)n=r(t);else if(l.isURLSearchParams(t))n=t.toString();else{var o=[];l.forEach(t,function(e,t){null!=e&&(l.isArray(e)?t+="[]":e=[e],l.forEach(e,function(e){l.isDate(e)?e=e.toISOString():l.isObject(e)&&(e=JSON.stringify(e)),o.push(y(t)+"="+y(e))}))}),n=o.join("&")}if(n){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}((e=h.baseURL,r=h.url,e&&!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(r)?(n=e,(o=r)?n.replace(/\/+$/,"")+"/"+o.replace(/^\/+/,""):n):r),h.params,h.paramsSerializer),success:function(e){var t,r,n,o,i,a,u,c,s,f,l=(r=h,n=m,o=(t=e).header||t.headers,i=t.statusCode||t.status,a="",200===i?a="OK":400===i&&(a="Bad Request"),{data:t.data,status:i,statusText:a,headers:o,config:r,request:n});u=d,c=p,!(f=(s=l).config.validateStatus)||f(s.status)?u(s):c(b("Request failed with status code "+s.status,s.config,null,s.request,s))},fail:function(e){!function(e,t,r){switch(v){case"wechat":-1!==e.errMsg.indexOf("request:fail abort")?t(b("Request aborted",r,"ECONNABORTED","")):-1!==e.errMsg.indexOf("timeout")?t(b("timeout of "+r.timeout+"ms exceeded",r,"ECONNABORTED","")):t(b("Network Error",r,null,""));break;case"alipay":[14,19].includes(e.error)?t(b("Request aborted",r,"ECONNABORTED","")):[13].includes(e.error)?t(b("timeout of "+r.timeout+"ms exceeded",r,"ECONNABORTED","")):t(b("Network Error",r,null,""));break;case"baidu":t(b("Network Error",r,null,""))}}(e,p,h)},complete:function(){t=void 0}};if(h.auth){var u=[h.auth.username||"",h.auth.password||""],c=u[0],s=u[1];a.Authorization="Basic "+function(e){for(var t,r,n=String(e),o=0,i=g,a="";n.charAt(0|o)||(i="=",o%1);a+=i.charAt(63&t>>8-o%1*8)){if(255<(r=n.charCodeAt(o+=.75)))throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");t=t<<8|r}return a}(c+":"+s)}0!==h.timeout&&w('The "timeout" option is not supported by miniprogram. For more information about usage see "https://developers.weixin.qq.com/miniprogram/dev/framework/config.html#全局配置"'),l.forEach(a,function(e,t){var r=t.toLowerCase();(void 0===i&&"content-type"===r||"referer"===r)&&delete a[t]}),m.header=a,h.responseType&&(m.responseType=h.responseType),h.cancelToken&&h.cancelToken.promise.then(function(e){t&&(t.abort(),p(e),t=void 0)}),function(e){try{return"string"==typeof e&&e.length&&(e=JSON.parse(e))&&"[object Object]"===Object.prototype.toString.call(e)}catch(e){return!1}}(i)&&(i=JSON.parse(i)),void 0!==i&&(m.data=i),t=f(m)})}});
